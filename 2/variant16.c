/**
 * @file variant16.c
 * @brief Вычисление сложной функции с вложенными циклами и проверкой области определения (ОДЗ).
 * 
 * Цель: Вычислить f(x) в заданном интервале [x1, x2] с шагом h.
 * Функция включает сумму от n=1 до 4, итерационное возведение в степень
 * и строгую проверку ОДЗ.
 * 
 * Вариант: 16
 */

#include <stdio.h>
#include <math.h>
#include <stdlib.h>

int main() {
    double x1, x2, h;
    int items_read;

    // --- Цикл валидации ввода ---
    // Программа повторяет запрос, пока не будут введены корректные границы интервала и шаг.
    while (1) {
        printf("Введите границы интервала (x1, x2) и шаг (h): ");
        items_read = scanf("%lf %lf %lf", &x1, &x2, &h);

        // Проверка корректности чтения трех значений
        if (items_read != 3) {
            printf("Ошибка: Неверный формат ввода. Пожалуйста, введите числа.\n");
            // Очистка буфера ввода
            while (getchar() != '\n');
            continue;
        }

        // Проверка логической согласованности: шаг должен быть положительным, и x1 <= x2
        if (h <= 0) {
            printf("Ошибка: Шаг h должен быть положительным.\n");
            continue;
        }
        if (x1 > x2) {
            printf("Ошибка: x1 должен быть меньше или равен x2.\n");
            continue;
        }
        break; // Ввод корректен
    }

    printf("\nРезультаты вычисления f(x) для Варианта 16:\n");
    printf("--------------------------------------------------------------------------------\n");
    printf("|     x      |    f(x)    |     x      |    f(x)    |     x      |    f(x)    |\n");
    printf("--------------------------------------------------------------------------------\n");

    int col_count = 0;
    // --- Внешний цикл: итерация по диапазону x ---
    for (double x = x1; x <= x2 + h/1e6; x += h) {
        int undef = 0;
        double fx = 0.0;

        // --- Проверка области определения (ОДЗ) ---
        // f(x) = [(ln x - 2)/(x - 1)] * Sum + sqrt(ln|x - 7|)
        // 1. x > 0 для ln(x)
        // 2. x != 1 для знаменателя (x-1)
        // 3. |x-7| > 0 для ln|x-7| (означает x != 7)
        // 4. ln|x-7| >= 0 для sqrt (означает |x-7| >= 1, т.е. x <= 6 или x >= 8)
        
        if (x <= 0) undef = 1;
        else if (fabs(x - 1.0) < 1e-9) undef = 1;
        else if (fabs(x - 7.0) < 1e-9) undef = 1;
        else if (fabs(x - 7.0) < 1.0) undef = 1; // Промежуток между 6 и 8

        if (!undef) {
            // --- Внутренний цикл: вычисление суммы от n=1 до 4 ---
            double sum = 0.0;
            double pow5 = 1.0; // Переменная для итерационного накопления 5^n

            for (int n = 1; n <= 4; n++) {
                pow5 *= 5.0; // Итерационное вычисление: 5^1, 5^2, 5^3, 5^4
                sum += (pow5 + x) / (n + 3.0);
            }

            // --- Финальное вычисление функции ---
            double term1 = (log(x) - 2.0) / (x - 1.0);
            double term2 = sqrt(log(fabs(x - 7.0)));
            fx = term1 * sum + term2;
        }

        // --- Форматирование вывода с проверкой на переполнение ---
        printf("| %10.4f | ", x);
        if (undef) {
            printf("%10s | ", "не опр.");
        } else if (fabs(fx) > 1e6) {
            printf("%10s | ", "переполн.");
        } else {
            printf("%10.4f | ", fx);
        }

        col_count++;
        // Если выведено 3 элемента, переход на новую строку
        if (col_count % 3 == 0) {
            printf("\n");
        }
    }

    // Финальный перенос строки, если последняя строка не полная
    if (col_count % 3 != 0) {
        printf("\n");
    }
    printf("--------------------------------------------------------------------------------\n");

    return 0;
}
